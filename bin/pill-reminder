#!/usr/bin/env node

var TelegramBot = require('node-telegram-bot-api');
var Models = require('../database/models/models');

console.log('Executando scheduled job');

var bot = new TelegramBot(process.env.TELEGRAM_BOT_TOKEN);

function pillReminder() {
  console.log('Executando task');
  
  Models.PillReminder.find(function(err, objs){
    console.log('Find executado. Obj de erro: ', err);  
    console.log('Find executado. Obj de retorno do find: ', objs);  
    objs.forEach(function(item){
        console.log('Enviando mensagem');
        bot.sendMessage(item._doc.chatId, "Vai tomar o rem√©dio...");
    });
  });
}

pillReminder();

process.exit();
